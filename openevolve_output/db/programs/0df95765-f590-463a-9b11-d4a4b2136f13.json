{"id": "0df95765-f590-463a-9b11-d4a4b2136f13", "code": "import os\n\nfrom qos.error_mitigator.analyser import IsQAOACircuitPass, QAOAAnalysisPass\nfrom qos.error_mitigator.optimiser import FrozenQubitsPass\nfrom qos.types.types import Qernel\n\n\ndef evolved_run(self, q: Qernel):\n    # OE_BEGIN\n    for key in self.methods:\n        self.methods[key] = True\n\n    is_qaoa_pass = IsQAOACircuitPass()\n    budget = self.budget\n    if is_qaoa_pass.run(q):\n        qaoa_analysis_pass = QAOAAnalysisPass()\n        qaoa_analysis_pass.run(q)\n        metadata = q.get_metadata()\n        num_cnots = metadata[\"num_nonlocal_gates\"]\n        hotspots = list(metadata[\"hotspot_nodes\"].values())\n        qubits_to_freeze = sum(1 for hs in hotspots if hs / num_cnots >= 0.07)\n        qubits_to_freeze = min(qubits_to_freeze, budget)\n\n        if qubits_to_freeze > 0:\n            QF_pass = FrozenQubitsPass(qubits_to_freeze)\n            q = QF_pass.run(q)\n            budget -= qubits_to_freeze\n\n    size_to_reach = self.size_to_reach\n    costs = self.computeCuttingCosts(q, size_to_reach)\n    max_iters = int(os.getenv(\"QOS_COST_SEARCH_MAX_ITERS\", \"5\"))\n    iter_ctr = 0\n\n    # Improved ordering and condition for applying techniques\n    while (costs[\"GV\"] <= budget or costs[\"WC\"] <= budget) and size_to_reach > 2:\n        iter_ctr += 1\n        if max_iters > 0 and iter_ctr > max_iters:\n            break\n        size_to_reach -= 1\n        costs = self.computeCuttingCosts(q, size_to_reach)\n\n    while costs[\"GV\"] > budget and costs[\"WC\"] > budget:\n        iter_ctr += 1\n        if max_iters > 0 and iter_ctr > max_iters:\n            break\n        size_to_reach += 1\n        costs = self.computeCuttingCosts(q, size_to_reach)\n\n    if costs[\"GV\"] <= budget or costs[\"WC\"] <= budget:\n        if costs[\"GV\"] <= costs[\"WC\"]:\n            q = self.applyGV(q, size_to_reach)\n        else:\n            q = self.applyWC(q, size_to_reach)\n\n    q = self.applyQR(q, self.size_to_reach)\n\n    # OE_END\n    return q", "language": "python", "parent_id": "21c0d4f1-dd84-4697-b702-7026a3b2d002", "generation": 2, "timestamp": 1766684249.2670121, "iteration_found": 5, "metrics": {"rel_depth": 1.8181818181818181, "rel_cnot": 5.5, "rel_overhead": 1.0, "combined_score": 0.12007422770439909}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"rel_depth": 4.8, "rel_cnot": 10.0, "rel_overhead": 1.0, "combined_score": 0.06325110689437065}, "island": 0}, "prompts": null, "artifacts_json": null, "artifact_dir": null, "embedding": null}