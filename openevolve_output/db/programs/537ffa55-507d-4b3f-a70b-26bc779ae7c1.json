{"id": "537ffa55-507d-4b3f-a70b-26bc779ae7c1", "code": "import os\n\nfrom qos.error_mitigator.analyser import IsQAOACircuitPass, QAOAAnalysisPass\nfrom qos.error_mitigator.optimiser import FrozenQubitsPass\nfrom qos.types.types import Qernel\n\n\ndef evolved_run(self, q: Qernel):\n    # OE_BEGIN\n    for key in self.methods:\n        self.methods[key] = True\n\n    is_qaoa_pass = IsQAOACircuitPass()\n    budget = self.budget\n    if is_qaoa_pass.run(q):\n        qaoa_analysis_pass = QAOAAnalysisPass()\n        qaoa_analysis_pass.run(q)\n        metadata = q.get_metadata()\n        num_cnots = metadata[\"num_nonlocal_gates\"]\n        hotspots = list(metadata[\"hotspot_nodes\"].values())\n        qubits_to_freeze = sum(1 for hs in hotspots if hs / num_cnots >= 0.07)\n        qubits_to_freeze = min(qubits_to_freeze, budget)\n\n        if qubits_to_freeze > 0:\n            QF_pass = FrozenQubitsPass(qubits_to_freeze)\n            q = QF_pass.run(q)\n            budget -= qubits_to_freeze\n\n    size_to_reach = self.size_to_reach\n    costs = self.computeCuttingCosts(q, size_to_reach)\n    max_iters = int(os.getenv(\"QOS_COST_SEARCH_MAX_ITERS\", \"5\"))\n    iter_ctr = 0\n\n    # Improved ordering and condition for applying techniques\n    while (costs[\"GV\"] <= budget or costs[\"WC\"] <= budget) and size_to_reach > 2:\n        iter_ctr += 1\n        if max_iters > 0 and iter_ctr > max_iters:\n            break\n        size_to_reach -= 1\n        costs = self.computeCuttingCosts(q, size_to_reach)\n\n    while costs[\"GV\"] > budget and costs[\"WC\"] > budget:\n        iter_ctr += 1\n        if max_iters > 0 and iter_ctr > max_iters:\n            break\n        size_to_reach += 1\n        costs = self.computeCuttingCosts(q, size_to_reach)\n\n    if costs[\"GV\"] <= budget or costs[\"WC\"] <= budget:\n        technique = \"GV\" if costs[\"GV\"] <= costs[\"WC\"] else \"WC\"\n        q = getattr(self, f\"apply{technique}\")(q, size_to_reach)\n\n    q = self.applyQR(q, self.size_to_reach)\n\n    # OE_END\n    return q", "language": "python", "parent_id": "026ffffe-6e8f-4786-b250-0c990a4879d8", "generation": 2, "timestamp": 1766684400.752638, "iteration_found": 7, "metrics": {"rel_depth": 1.0, "rel_cnot": 1.0, "rel_overhead": 1.0, "combined_score": 0.33222591362126247}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"rel_depth": 1.0, "rel_cnot": 1.0, "rel_overhead": 1.0, "combined_score": 0.33222591362126247}, "island": 0}, "prompts": null, "artifacts_json": null, "artifact_dir": null, "embedding": null}