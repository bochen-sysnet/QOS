max_iterations: 500
checkpoint_interval: 10
log_level: "INFO"
log_dir: null
random_seed: 42

# Rewrite mode: output full file each iteration (stable with OE markers)
diff_based_evolution: false
max_code_length: 30000

early_stopping_patience: null
convergence_threshold: 0.001
early_stopping_metric: "combined_score"

llm:
  api_base: "http://localhost:8000/v1"
  primary_model: "Qwen/Qwen2.5-Coder-14B-Instruct-AWQ"
  temperature: 0.75
  top_p: 0.92
  max_tokens: 1800
  timeout: 450
  retries: 3
  retry_delay: 1

prompt:
  system_message: |
    You are OpenEvolve. You are optimizing ONLY the function evolved_cost_search(self, q, size_to_reach, budget).

    CRITICAL OUTPUT REQUIREMENT:
      - Always output the ENTIRE FILE (all imports + full evolved_cost_search definition), not just the OE region.
      - HOWEVER, you MUST ONLY MODIFY code between markers '# OE_BEGIN' and '# OE_END'.
      - Do not change imports, module-level code, class/function signatures, or anything outside markers.

    TASK CONTEXT:
      - Input q is a Qernel. Metadata is available via q.get_metadata().
      - evolved_cost_search is stateless across calls (no caching across runs).
      - Evaluator selects circuits uniformly at random (uniform selection).
      - evolved_cost_search is a helper used by ErrorMitigator.run; it must not apply transformations.

    Your job is to refine the cost-search loops that pick size_to_reach and compute GV/WC costs.

    AVAILABLE TECHNIQUES (already implemented elsewhere):
      - Gate virtualization cost (GVOptimalDecompositionPass)
      - Wire cutting cost (OptimalWireCuttingPass)

    METRICS:
      - rel_depth: depth(QOSE) / depth(QOS)
      - rel_cnot:  cnot(QOSE) / cnot(QOS)
      - rel_overhead: num_circuits(QOSE) / num_circuits(QOS)
      - avg_run_time: average evolved mitigator runtime in seconds
      - combined_score (maximize):
          combined_score = 1.0 / (1.0 + rel_depth + rel_cnot + rel_overhead/10.0 + avg_run_time/10.0)

    IMPORTANT:
      - budget is the constraint for baseline QOS and is NOT necessarily a hard constraint for evolved_cost_search.
        You may treat it only as a soft heuristic.

    ARTIFACTS PROVIDED BY EVALUATOR (per case):
      - input_features: depth, num_qubits, num_nonlocal_gates, program_communication, liveness,
        parallelism, measurement, entanglement_ratio, critical_depth
      - cost_search_sec: time spent in cost_search for the case
      - cost_search_calls: number of cost_search invocations for the case
      - gv_cost_calls: number of GV cost calls for the case
      - wc_cost_calls: number of WC cost calls for the case
      Use artifacts to diagnose regressions and avoid repeated computeCuttingCosts loops.

    ARTIFACTS PROVIDED BY EVALUATOR (summary):
      - evolved_run_sec_avg: average runtime of evolved mitigator
      - cost_search_sec_avg: average time per cost_search call
      - gv_cost_calls_total: total GV cost calls
      - wc_cost_calls_total: total WC cost calls

    HARD CONSTRAINTS:
      - Deterministic execution (no randomness).
      - Runtime: bounded candidate search; do NOT use unbounded loops.
      - Do not introduce new imports or new module dependencies.

    IMPORTANT LEVERS TO EXPLORE (must explore across evolution):
      A) Decide to use WC or GV selectively instead of always using both.

      B) Explore size_to_reach efficiently instead of using two while loops.

      C) Explore early stopping rules for WC and GV.

  evaluator_system_message: "You are a strict code reviewer. Do not add commentary."
  num_top_programs: 2
  num_diverse_programs: 2
  use_template_stochasticity: true

  # Make sure OpenEvolve passes artifacts back into the model prompt each iteration.
  include_artifacts: true
  max_artifact_bytes: 65536
  artifact_security_filter: true

database:
  db_path: openevolve_output/db
  in_memory: false
  log_prompts: true

  population_size: 24
  archive_size: 16
  num_islands: 4

  migration_interval: 30
  migration_rate: 0.12

  elite_selection_ratio: 0.05
  exploration_ratio: 0.65
  exploitation_ratio: 0.30

  feature_dimensions:
    - "complexity"
    - "diversity"
  feature_bins: 12
  diversity_reference_size: 30

evaluator:
  timeout: 300
  max_retries: 1
  cascade_evaluation: false
  parallel_evaluations: 1
  use_llm_feedback: false
  llm_feedback_weight: 0.0

evolution_trace:
  enabled: false
  format: "jsonl"
  include_code: false
  include_prompts: false
  output_path: openevolve_output/evolution_trace.jsonl
  buffer_size: 10
  compress: false
